version: 0.2

# AWS CodeBuild Specification for Fast Food App

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - echo "ğŸ”§ Installing build tools..."
      - echo "Node version:" $(node --version)
      - echo "NPM version:" $(npm --version)
      
  pre_build:
    commands:
      - echo "ğŸ” ===== PRE-BUILD PHASE ====="
      - echo "ğŸ“¦ Installing dependencies..."
      - npm install
      - echo "âœ… Dependencies installed successfully!"
      
  build:
    commands:
      - echo "ğŸ”¨ ===== BUILD PHASE ====="
      - echo "ğŸ“… Build started on $(date)"
      - echo "ğŸ§ª Running tests..."
      - npm test
      - echo "âœ… Tests passed!"
      
      - echo "ğŸ“ Adding build metadata..."
      - BUILD_TIME=$(date +%Y%m%d-%H%M%S)
      - BUILD_ID="AWS-${CODEBUILD_BUILD_NUMBER}-${BUILD_TIME}"
      - echo "Build ID:" $BUILD_ID
      
      # Update build version in HTML
      - sed -i "s/1.0/1.0.${CODEBUILD_BUILD_NUMBER}/g" index.html
      
      - echo "âœ… Build completed successfully!"
      
  post_build:
    commands:
      - echo "ğŸ“¦ ===== POST-BUILD PHASE ====="
      - echo "ğŸ“‹ Creating deployment package..."
      - echo "Files to be deployed:"
      - ls -lh
      - echo "âœ… Build artifacts ready for deployment!"

artifacts:
  files:
    - '**/*'
  name: fastfood-app-build-$(date +%Y%m%d-%H%M%S)
  
cache:
  paths:
    - 'node_modules/**/*'
